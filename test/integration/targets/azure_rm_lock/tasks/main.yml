- name: Add lock to resource group (check_mode)
  azure_rm_lock:
      name: keep
      resource_group: "{{ resource_group }}"
      level: read_only
  register: lock
  check_mode: yes

- assert:
      that:
          - lock.changed

- name: Query lock
  azure_rm_lock_facts:
      resource_group: "{{ resource_group }}"
  register: locks

- assert:
      that:
          - locks.locks | length == 0

- name: Add lock to resource group
  azure_rm_lock:
      name: keep
      resource_group: "{{ resource_group }}"
      level: read_only
  register: lock

- assert:
      that:
          - lock.changed
          - lock.id

- name: Query lock
  azure_rm_lock_facts:
      name: keep
      resource_group: "{{ resource_group }}"
  register: locks

- assert:
      that:
          - locks.locks | length == 1

- name: Get resource group id
  azure_rm_resource_facts:
      name: "{{ resource_group }}"

- name: Update lock to resource group (idempontent)
  azure_rm_lock:
      name: keep
      resource_id: "{{ azure_resourcegroups[0].id }}"
      level: read_only
  register: lock1

- assert:
      that:
          - not lock1.changed
          - lock1.id == lock.id

- name: Update lock level
  azure_rm_lock:
      name: keep
      resource_id: "{{ azure_resourcegroups[0].id }}"
      level: can_not_delete
  register: lock

- assert:
      that:
          - lock.changed
          - lock.level == 'can_not_delete'

- name: Delete lock
  azure_rm_lock:
      name: keep
      resource_group: "{{ resource_group }}"
  register: lock

- assert:
      that:
          - lock.changed

- name: Query lock
  azure_rm_lock_facts:
      resource_group: "{{ resource_group }}"
  register: locks

- assert:
      that:
          - locks.locks | length == 0